<apex:page lightningStylesheets="true">
    <apex:slds />
    <div class="slds-scope">
        <div class="slds-p-around_small">
            <label>Enter your publish Message</label>
            <input type="text" class="slds-input" id="messageField" />
            <div class="slds-p-top_small slds-p-nottom_small">
                <button class="slds-button slds-button_neutral" onclick="publishHandler()">Publish</button>
                <button class="slds-button slds-button_neutral" onclick="subscriberHandler()">Subscribe</button>
                <button class="slds-button slds-button_neutral" onclick="unsubscriberHandler()">Unsubscribe</button>
            </div>
        </div>
        <p>Message Recived</p>
        <div id="recievedMessage"></div>
    </div>
    <script>
        
        let SAMPLEMC = '{!$MessageChannel.SampleMessageChannel__c}';
        let subscriptionToMC;

        function publishHandler(){
            let data = document.getElementById('messageField').value;
            const message = {
                lsmData:{
                    value:data
                }
            }
            sforce.one.publish(SAMPLEMC, message);
        }

        function subscriberHandler(){
            if(!subscriptionToMC){
                subscriptionToMC = sforce.one.subscribe(SAMPLEMC, msgHandler, {scope:'APPLICATION'});
            }
        }

        function unsubscriberHandler(){
            if(subscriptionToMC){
                sforce.one.unsubscribe(subscriptionToMC);
                subscriptionToMC = null;
            }
        }

        function msgHandler(message){
            let recievedMessage = document.getElementById('recievedMessage');
            recievedMessage.innerHTML = message && message.lsmData ? message.lsmData.value : 'NO DATA SEND';
        }

    </script>
</apex:page>